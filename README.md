[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

# Simon Stenberg 3D yeast tools

ImageJ macro tools for Simon Stenberg to assist him in his yeast segmentation and quantification

## IJ Macros

### Dependencies

For the macros to run you need to first install the plugin: [MorphoLibJ](https://imagej.net/plugins/morpholibj#installation)

### Segmentation

* [Simon_yeast_segementation.ijm](./IJ_macros/Simon_yeast_segmentation.ijm): The purpose of this macro is to segment yeast cells from 3 or 2 color images. As further post-processing, the algorithm tries to suggest good seeds that can be used later on to separate touching objects via watershed.

* [Simon_mito_segmentation.ijm](./IJ_macros/Simon_mito_segmentation.ijm): The purpose of this macro is to segment mitochondria from 3 or 2 color images. The user must select the mitochondria color channel and then segmentation takes place, taking advantage of 3D filtering.

### Seed based watershed

In the imaging conditions used in this study, separating single yeast cells from their neighbors can be challenging. Thus we used a seed-based watershed algorithm to separate touching objects after segmentation. The seeds are prepared in a semi-automated fashion. The initial segmentation suggests seeds and the user then uses other macros to improve this suggestion by either adding or removing seeds. 3 macros are used together:

* [improve_seg.ijm](./IJ_macros/improve_seg.ijm): The purpose of this macro is to help with the seed generation done during the yeast segmentation. Once it runs on an output folder it will show the current status of the object separation via watershed. If in this step a mistake is found then you can use:

  * [Add_seed.ijm](./IJ_macros/Add_seed.ijm): to add seeds by clicking (point selection tool) on the cell body you want to separate. After clicking, you must run add seed. At this point, you can add another seed, then click run again. Once you added a few easy seeds, then you can save the new seeds and run again improve_seg.ijm to see the current state of the watershed output.

  * [Remove_seed.ijm](./IJ_macros/Remove_seed.ijm): removes a particular seed by clicking (point selection) on the seed you want to remove. After removing one or several seeds you have to save the new seeds.

### Save labels after the watershed

Once you are happy with the seeds then you can save the output after the watershed, which is a label image/volume. This will be used later on for the calculation of mitochondria properties per yeast cell. To do so run the macro:

* [save_labels.ijm](./IJ_macros/save_labels.ijm)

## Matlab script

### External Dependencies

For the main function to run properly (due to loading of tif meta data) you need to first install [bioFormats toolbox](https://docs.openmicroscopy.org/bio-formats/6.1.0/users/matlab/index.html).

### General description

This code goes over a directory and finds all sub-folders that were generated by the IJmacors above. Then it loads the yeast label image and the mitochondria segmentation. Each yeast cell is then treated separately:

1. Yeast cells are tested for the presence of daughter cells, if a daughter cell is present then mother and daughter are separated. We will only focus on the mitochondria in mother cells, form now on called cell bodies.

2. Cell bodies are smoothed.

3. Mithocondria inside the cell body are then characterized in terms of their shape and volume.

4. output tables are generated.

### output table variables

* data_name: name of the original image file used for analysis.

* Cell_idx: unique identifier for the cell in the particular data set.

* Cell_Volume(_micron): Volume of the cell body in pixels (or in microns).

* Daughter_Volume(_micron): if a daughter cell was detected then we print its volume in pixels (or in microns).

* Mito_number: number of isolated mitochondrial bodies detected. Note that due to the optical resolution limits this is not the same as the actual number of mitochondria present inside the cell, as we can only separate objects that are farther away than the diffraction limit.

* Mito_volume(_micron): volume of the isolated mitochondrial bodies in pixels (or in microns).

* Mito_diamater(_micron): quick and fast calculation of the diameter of a tubular object by first skeletonizing the body and then measuring the median distance from the skeleton to the object's boundary. The diameter is given in pixels (or in microns).

* Mito_SkelPix_Micron: quick measurement of the length of the skeleton in units of microns. Due to the pixelation of the skeleton, this measurement is prone to small rounding errors.

* Mito_Vol_Ratio: the volumetric ratio between the isolated mitochondrial body and the total volume of the mother cell.
